
<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="user-scalable=0, width=device-width, initial-scale=1.0,  minimum-scale=1.0, maximum-scale=1.0">
    <title>United Healthcare</title>
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>

    <link rel="icon" href="favicon.ico">
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/style.css">

    <script>
        var env = "ALPHA";

        function getURLParams(search) {
            var queryParams = {}, queryArray, singleQuery;
            queryArray = search.substr(1).split("&");
            for (var i = 0; i < queryArray.length; i++) {
                if (queryArray[i].indexOf("=") > -0) {
                    singleQuery = queryArray[i].split("=");
                    if (singleQuery.length == 2) {
                        queryParams[decodeURIComponent(singleQuery[0])] = decodeURIComponent(singleQuery[1]);
                    }
                }
            }
            return queryParams;
        }
        
        var params = getURLParams(window.location.search);

        var site = params.site || "";
        var isCdnTagJs = params.cdn_tag_js === "true";
        var isCdnTaglets = params.cdn_taglets === "true";

    </script>

    <!-- BEGIN LivePerson Monitor. -->
    <script language="javascript">
        if (isCdnTagJs) {
            if (isCdnTaglets) {
                window.lpTag=window.lpTag||{},"undefined"==typeof window.lpTag._tagCount?(window.lpTag={site:site||"",section:lpTag.section||"",tagletSection:lpTag.tagletSection||null,autoStart:lpTag.autoStart!==!1,ovr:lpTag.ovr||{domain: 'cdn-a.lpsnmedia.net', tagjsdomain: 'cdn-a.lpsnmedia.net'},_v:"1.10.0",_tagCount:1,protocol:"https:",events:{bind:function(t,e,i){lpTag.defer(function(){lpTag.events.bind(t,e,i)},0)},trigger:function(t,e,i){lpTag.defer(function(){lpTag.events.trigger(t,e,i)},1)}},defer:function(t,e){0==e?(this._defB=this._defB||[],this._defB.push(t)):1==e?(this._defT=this._defT||[],this._defT.push(t)):(this._defL=this._defL||[],this._defL.push(t))},load:function(t,e,i){var n=this;setTimeout(function(){n._load(t,e,i)},0)},_load:function(t,e,i){var n=t;t||(n=this.protocol+"//"+(this.ovr&&this.ovr.tagjsdomain?this.ovr.tagjsdomain:"cdn.lpsnmedia.net")+"/p/tag-js/latest/tag.js?site="+this.site);var a=document.createElement("script");a.setAttribute("charset",e?e:"UTF-8"),i&&a.setAttribute("id",i),a.setAttribute("src",n),document.getElementsByTagName("head").item(0).appendChild(a)},init:function(){this._timing=this._timing||{},this._timing.start=(new Date).getTime();var t=this;window.attachEvent?window.attachEvent("onload",function(){t._domReady("domReady")}):(window.addEventListener("DOMContentLoaded",function(){t._domReady("contReady")},!1),window.addEventListener("load",function(){t._domReady("domReady")},!1)),"undefined"==typeof window._lptStop&&this.load()},start:function(){this.autoStart=!0},_domReady:function(t){this.isDom||(this.isDom=!0,this.events.trigger("LPT","DOM_READY",{t:t})),this._timing[t]=(new Date).getTime()},vars:lpTag.vars||[],dbs:lpTag.dbs||[],ctn:lpTag.ctn||[],sdes:lpTag.sdes||[],ev:lpTag.ev||[]},lpTag.init()):window.lpTag._tagCount+=1;
            } else {
                window.lpTag=window.lpTag||{},"undefined"==typeof window.lpTag._tagCount?(window.lpTag={site:site||"",section:lpTag.section||"",tagletSection:lpTag.tagletSection||null,autoStart:lpTag.autoStart!==!1,ovr:lpTag.ovr||{domain: 'lptag-a.liveperson.net', tagjsdomain: 'cdn-a.lpsnmedia.net'},_v:"1.7.0",_tagCount:1,protocol:"https:",events:{bind:function(t,e,i){lpTag.defer(function(){lpTag.events.bind(t,e,i)},0)},trigger:function(t,e,i){lpTag.defer(function(){lpTag.events.trigger(t,e,i)},1)}},defer:function(t,e){0==e?(this._defB=this._defB||[],this._defB.push(t)):1==e?(this._defT=this._defT||[],this._defT.push(t)):(this._defL=this._defL||[],this._defL.push(t))},load:function(t,e,i){var n=this;setTimeout(function(){n._load(t,e,i)},0)},_load:function(t,e,i){var n=t;t||(n=this.protocol+"//"+(this.ovr&&this.ovr.tagjsdomain?this.ovr.tagjsdomain:"cdn.lpsnmedia.net")+"/p/tag-js/latest/tag.js?site="+this.site);var a=document.createElement("script");a.setAttribute("charset",e?e:"UTF-8"),i&&a.setAttribute("id",i),a.setAttribute("src",n),document.getElementsByTagName("head").item(0).appendChild(a)},init:function(){this._timing=this._timing||{},this._timing.start=(new Date).getTime();var t=this;window.attachEvent?window.attachEvent("onload",function(){t._domReady("domReady")}):(window.addEventListener("DOMContentLoaded",function(){t._domReady("contReady")},!1),window.addEventListener("load",function(){t._domReady("domReady")},!1)),"undefined"==typeof window._lptStop&&this.load()},start:function(){this.autoStart=!0},_domReady:function(t){this.isDom||(this.isDom=!0,this.events.trigger("LPT","DOM_READY",{t:t})),this._timing[t]=(new Date).getTime()},vars:lpTag.vars||[],dbs:lpTag.dbs||[],ctn:lpTag.ctn||[],sdes:lpTag.sdes||[],ev:lpTag.ev||[]},lpTag.init()):window.lpTag._tagCount+=1;
            }
        } else {
            window.lpTag=window.lpTag||{},"undefined"==typeof window.lpTag._tagCount?(window.lpTag={site:site||"",section:lpTag.section||"",tagletSection:lpTag.tagletSection||null,autoStart:lpTag.autoStart!==!1,ovr:lpTag.ovr||{domain: 'lptag-a.liveperson.net', tagjsdomain: 'lptag-a.liveperson.net'},_v:"1.7.0",_tagCount:1,protocol:"https:",events:{bind:function(t,e,i){lpTag.defer(function(){lpTag.events.bind(t,e,i)},0)},trigger:function(t,e,i){lpTag.defer(function(){lpTag.events.trigger(t,e,i)},1)}},defer:function(t,e){0==e?(this._defB=this._defB||[],this._defB.push(t)):1==e?(this._defT=this._defT||[],this._defT.push(t)):(this._defL=this._defL||[],this._defL.push(t))},load:function(t,e,i){var n=this;setTimeout(function(){n._load(t,e,i)},0)},_load:function(t,e,i){var n=t;t||(n=this.protocol+"//"+(this.ovr&&this.ovr.domain?this.ovr.domain:"lptag.liveperson.net")+"/tag/tag.js?site="+this.site);var a=document.createElement("script");a.setAttribute("charset",e?e:"UTF-8"),i&&a.setAttribute("id",i),a.setAttribute("src",n),document.getElementsByTagName("head").item(0).appendChild(a)},init:function(){this._timing=this._timing||{},this._timing.start=(new Date).getTime();var t=this;window.attachEvent?window.attachEvent("onload",function(){t._domReady("domReady")}):(window.addEventListener("DOMContentLoaded",function(){t._domReady("contReady")},!1),window.addEventListener("load",function(){t._domReady("domReady")},!1)),"undefined"==typeof window._lptStop&&this.load()},start:function(){this.autoStart=!0},_domReady:function(t){this.isDom||(this.isDom=!0,this.events.trigger("LPT","DOM_READY",{t:t})),this._timing[t]=(new Date).getTime()},vars:lpTag.vars||[],dbs:lpTag.dbs||[],ctn:lpTag.ctn||[],sdes:lpTag.sdes||[],ev:lpTag.ev||[]},lpTag.init()):window.lpTag._tagCount+=1;
        }
    </script>
    <!-- END LivePerson Monitor. -->

    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
        }
        .container {
            margin: 0 auto;
            background-color: #ffffff;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        h2 {
            color: #002677;
        }
        input[type="text"] {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            background-color: #002677;
            color: #ffffff;
            border: none;
            border-radius: 4px;
            padding: 10px 20px;
            cursor: pointer;
        }
        .logo {
            width: 75%; 
        }
        .sign-in-area {
            border-right: 1px solid #dfdfdf;
        }
        .sign-in-button {
            background-color: #ce4817;
        }
        .visitor-button {
            background-color: #002677;
        }
        .value-field {
            margin-top: 20px;
        }
        .jwt-field {
            max-width: 400px;
            border: 1px solid #dfdfdf;
            overflow-x: scroll;
        }
        .value-text {
            color: darkgreen;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row">
            <div class="col sign-in-area">
                <h1><img class="logo" src="https://member.uhc.com/myuhc/content/dam/myuhc/images/logo/MyUHC_Logo.svg" class="header__logo" alt="UnitedHealthCare Logo"></h1>
                <div>
                    <h2>
                        Welcome back<br />
                        Let's get you signed in again
                    </h2>
                    Easy access to plan information anytime anywhere. Get the most out of your coverage.<br />
                    <br />
                </div>
                <button type="button" class="sign-in-button" onclick="location.href='https://liveperson-web-experiences.netlify.app/v2/uhc/login.html?site=' + site + '&lpDebug=2';">Sign In</button>   
            </div>
            <div class="col">
                <b>Stored data</b> (<i>cookies</i>):
                <div id="LPVID" class="value-field">Loading..</div>
                <div id="LPSID" class="value-field"></div>
                <div id="-unAuthSub" class="value-field"></div>
                <div id="-unAuthJWT" class="value-field jwt-field"></div>
                <!--
                <form id="visitorForm">
                    <label for="lpvid">Set new visitor ID:</label>
                    <input type="text" id="lpvid" placeholder="Enter ID">
                    <button type="button" class="visitor-button" onclick="saveVisitorId()">Save</button>
                </form>
                -->
            </div>
        </div>
    </div>

    <script>
        const LPVID_KEY = "LPVID";
        const LPSID_KEY = "LPSID";
        const UNAUTH_JWT_KEY = "-unAuthJWT";
        const UNAUTH_SUB_KEY = "-unAuthSub";

        window.onload = function() {
            setInterval(() => { loadVisitor(); }, 3000);
        }

        async function loadVisitor() {
            var lpvid = getCookie(LPVID_KEY);
            document.getElementById(LPVID_KEY).innerHTML = `${LPVID_KEY}: <span class="value-text">${lpvid || "{not set}"}</span>`;

            var lpsid = getCookie(LPSID_KEY + "-" + site);
            document.getElementById(LPSID_KEY).innerHTML = `${LPSID_KEY}: <span class="value-text">${lpsid || "{not set}"}</span>`;

            var unauthJwt = await getUnauthJwt();
            saveCookie(UNAUTH_JWT_KEY, unauthJwt);
            document.getElementById(UNAUTH_JWT_KEY).innerHTML = `${UNAUTH_JWT_KEY}: <span class="value-text">${unauthJwt || "{not set}"}</span>`;

            var unauthSub = getUnauthSubFromJwt(unauthJwt);
            saveCookie(UNAUTH_SUB_KEY, unauthSub);
            document.getElementById(UNAUTH_SUB_KEY).innerHTML = `${UNAUTH_SUB_KEY}: <span class="value-text">${unauthSub || "{not set}"}</span>`;
        }

        function saveVisitor() {
            const lpvid = document.getElementById(LPVID_KEY).value;
            document.getElementById(LPVID_KEY).value = null;
            saveCookie(LPVID_KEY, lpvid);
            loadVisitor();
        }

        function getCookie(name) {
            var value = null;
            name = name + "=";
            var decodedCookie = decodeURIComponent(document.cookie);
            var cookieArray = decodedCookie.split(';');
            for(var i = 0; i < cookieArray.length; i++) {
                var cookie = cookieArray[i];
                while (cookie.charAt(0) == ' ') {
                    cookie = cookie.substring(1);
                }
                if (cookie.indexOf(name) == 0) {
                    value = cookie.substring(name.length, cookie.length);
                }
            }
            return value;
        }

        function getUnauthSubFromJwt(jwt) {
            var payload = {};
            if (jwt) {
                const jwtParts = jwt.split('.');
                if (jwtParts.length >= 2) {
                    try {
                        payload = JSON.parse(window.atob(jwtParts[1]));
                    } catch (e) {
                        console.log("error parsing jwt: " + e.message);
                    }
                }
            }
            return payload.sub;
        }

        async function getUnauthJwt() {
            return new Promise((resolve, reject) => {
                if (lpTag && lpTag.taglets) {
                    lpTag.taglets.lpSecureStorage.getValue({
                        key: UNAUTH_JWT_KEY,
                        site: site,
                        app: "unAuthMessaging",
                        success: (jwt) => { 
                            console.log(jwt);
                            resolve(jwt);
                        },
                        error: (err) => {
                            console.log(err);
                            reject();
                        },
                        appName: "unAuthMessaging",
                        domain: 'https://' + lpTag.csds.getDomain('leCdnDomain'),
                        firstParty: true
                    });
                } else {
                    reject();
                }
            });
        }

        function saveCookie(name, value) {
            if (name && value) {
                document.cookie = `${name}=${value}; path=/; secure; samesite=none`;
            }
        }
    </script>

    <!--<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="../js/bootstrap.min.js"></script>
</body>
</html>
